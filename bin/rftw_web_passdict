#!/bin/bash

# Default config path
CONFIG_PATH="${RECONFTW_CFG}"

# Check if the config file exists
if [[ -f "${CONFIG_PATH}" ]]; then
    source "${CONFIG_PATH}"
else
    echo "Error: reconftw.cfg not found at ${CONFIG_PATH}!"
    exit 1
fi

# Help menu
help_menu() {
	echo "$(basename "$0") [OPTIONS]"
	echo "Password Dictionary Generation using pydictor"
	echo ""
	echo "Options:"
	echo "  -d, --domain DOMAIN     Set domain (required)"
	echo "  -h, --help              Display this help message and exit"
	exit 0
}

# Input validation
if [[ $# -eq 0 ]]; then
	help_menu
fi

DOMAIN=""
while [[ $1 != "" ]]; do
	case $1 in
	-d | --domain)
		shift
		DOMAIN=$1
		;;
	-h | --help)
		help_menu
		exit
		;;
	*)
		echo "Unknown option: $1"
		exit 1
		;;
	esac
	shift
done

if [[ -z ${DOMAIN} ]]; then
	echo "Error: Domain is required!"
	exit 1
fi

password_dict() {
	local DOMAIN=$1

	start_func ${FUNCNAME[0]} "Password dictionary generation"

	local word=${DOMAIN%%.*}
	python3"${tools}"/pydictor/pydictor.py -extend $word --leet 0 1 2 11 21 --len ${PASSWORD_MIN_LENGTH} ${PASSWORD_MAX_LENGTH} -o webs/password_dict.txt

}

password_dict ${DOMAIN}
