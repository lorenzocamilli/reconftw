#!/bin/bash

# Load environment variables from reconftw.cfg
# Load environment variables
if [[ -f "reconftw.cfg" ]]; then
	source reconftw.cfg
else
	echo "Error: reconftw.cfg not found!"
	exit 1
fi

# Help menu function
function display_help() {
	echo "$(basename "$0") [OPTIONS]"
	echo
	echo "Perform SSL tests on provided inputs."
	echo "Options:"
	echo "  -h, --help    Display this help and exit"
	echo
}

# Validate requirements function
function validate_requirements() {
	if ! [[ -x "$(command -v"${tools}"/testssl.sh/testssl.sh)" ]]; then
		echo "Error: testssl.sh not found at specified location." >&2
		exit 1
	fi
	if ! [[ -f "hosts/ips.txt" ]]; then
		echo "Error: hosts/ips.txt not found." >&2
		exit 1
	fi
}

# SSL test function
function ssl_test() {
	echo "[*] Starting SSL Test"
	"${tools}"/testssl.sh/testssl.sh --quiet --color 0 -U -iL hosts/ips.txt 2>>"${LOGFILE}" >vulns/testssl.txt
	echo "[+] Results are saved in vulns/testssl.txt"
}

# Main script execution
while (("$#")); do
	case "$1" in
	-h | --help)
		display_help
		exit 0
		;;
	*)
		echo "Unknown parameter passed: $1"
		display_help
		exit 1
		;;
	esac
done

validate_requirements
ssl_test
