#!/bin/bash

# Help Menu
function display_help() {
    echo "Usage: $0 [OPTIONS]"
    echo "Options:"
    echo "  -d, --domain          Set the target domain."
    echo "  -l, --limit           Set the crt limit (default 100)."
    echo "  -D, --diff            Set DIFF to true."
    echo "  -s, --subcrt          Run crt subdomain enumeration."
    echo "  -i, --inscope         Check inscope."
    echo "  -o, --output          Specify the output file."
    echo "  -h, --help            Display this help menu."
}

# Other functions
function start_subfunc() {
    echo "[+] Starting $1: $2"
}

function end_subfunc() {
    echo "[+] Ending $1: $2"
}

# Variables for input and output
output_file=""

# Input validation and argument parsing
while [[ "$#" -gt 0 ]]; do
    case $1 in
        -d|--domain) domain="$2"; shift;;
        -l|--limit) CTR_LIMIT="$2"; shift;;
        -D|--diff) DIFF=true;;
        -s|--subcrt) SUBCRT=true;;
        -i|--inscope) INSCOPE=true;;
        -o|--output) 
            shift;
            output_file="$1";
            touch "$output_file" 2>/dev/null || { echo "Error: Cannot write to the specified output file."; exit 1; }
            ;;
        -h|--help) display_help; exit 0;;
        *) echo "Unknown parameter passed: $1"; display_help; exit 1;;
    esac
    shift
done

# Main Functionality
crt -s -json -l ${CTR_LIMIT} $domain 2>>"$LOGFILE" | jq -r '.[].subdomain' 2>>"$LOGFILE" | sed -e "s/^\\*\\.//" | anew -q .tmp/crtsh_subs_tmp.txt 2>>"$LOGFILE" >/dev/null
