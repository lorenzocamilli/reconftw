#!/bin/bash

# Description: Script to perform Google dorks

# Help menu
function help_menu() {
	echo -e "Usage: ./rftw_osint_googledorks.sh [OPTIONS]"
	echo -e "Options:"
	echo -e "  -d, --domain DOMAIN       Specify the domain"
	echo -e "  -o, --output FILE         (Optional) Specify the output directory file"
	echo -e "  -h, --help                Display this help menu"
	exit 1
}

# Main function
function google_dorks() {
	output_file_arg=""
	if [[ -n ${output} ]]; then
		output_file_arg="-o ${output}"
	fi

	python3 "${tools}/dorks_hunter/dorks_hunter.py" -d "${DOMAIN}" "${output_file_arg}" || {
		echo -e "${bred}Error: dorks_hunter.py failed.${reset}" >&2
		exit 1
	}
}

# Parse command-line arguments
DOMAIN=""
output=""
while [[ $# -gt 0 ]]; do
	case $1 in
	-d | --domain)
		DOMAIN="$2"
		shift
		;;
	-o | --output)
		output="$2"
		shift
		;;
	-h | --help) help_menu ;;
	*)
		echo -e "${bred}Unknown parameter passed: $1${reset}" >&2
		help_menu
		;;
	esac
	shift
done

# Validate inputs
if [[ -z ${DOMAIN} ]]; then
	echo -e "${bred}Error: Missing required parameters.${reset}" >&2
	help_menu
	exit 1
fi

# Validate the domain using the utility script
rftw_util_validatedomain "${DOMAIN}" || exit 1

# Execute the main function
google_dorks
