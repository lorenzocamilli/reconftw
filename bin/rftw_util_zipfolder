#!/bin/bash

# Default config path
CONFIG_PATH="${RECONFTW_CFG}"

# Check if the config file exists
if [[ -f "${CONFIG_PATH}" ]]; then
    source "${CONFIG_PATH}"
else
    echo "Error: reconftw.cfg not found at ${CONFIG_PATH}!"
    exit 1
fi

# Help menu function
function display_help() {
	echo "$(basename "$0") [DOMAIN]"
	echo
	echo "Zips the specified domain's output folder and sends the zip file."
	echo "Options:"
	echo "  -h, --help    Display this help and exit"
	echo
}

# Validate arguments function
function validate_args() {
	if [[ -z $1 ]]; then
		echo -e "${red}Error: DOMAIN is required.${reset}"
		display_help
		exit 1
	fi
}

# Main zipping and sending function
function zip_send_output_folder() {
	local DOMAIN="$1"
	local zip_name1=$(date +"%Y_%m_%d-%H.%M.%S")
	local zip_name="${zip_name1}_${DOMAIN}.zip"
	(cd "${dir}" && zip -r "${zip_name}" .)

	echo "Creating and sending zip file "${dir}/${zip_name}""

	if [[ -s "${dir}/$zip_name" ]]; then
		sendToNotify ""${dir}"/$zip_name"
		rm -f "${dir}/$zip_name"
	else
		notification "No Zip file to send" warn
	fi
}

# Main script execution
if [[ $1 == "-h" || $1 == "--help" ]]; then
	display_help
	exit 0
fi

validate_args "$1"
zip_send_output_folder "$1"
