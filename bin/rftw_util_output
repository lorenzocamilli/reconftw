#!/bin/bash

# Load environment variables from reconftw.cfg
# Load environment variables
if [ -f "reconftw.cfg" ]; then
    source reconftw.cfg
else
    echo "Error: reconftw.cfg not found!"
    exit 1
fi

# Colors for console output
green="\033[1;32m"
red="\033[1;31m"
reset="\033[0m"

# Help menu function
function display_help() {
    echo "$(basename "$0")"
    echo
    echo "Copies content of directory specified in 'dir' variable to 'dir_output' variable."
    echo "If 'dir' is different from 'dir_output', then 'dir' will be deleted."
    echo "Both 'dir' and 'dir_output' are sourced from the reconftw.cfg configuration file."
    echo "Options:"
    echo "  -h, --help    Display this help and exit"
    echo
}

# Validate directory existence function
function validate_dirs() {
    if [[ ! -d "$dir" ]]; then
        echo -e "${red}Error: '$dir' directory does not exist.${reset}"
        exit 2
    fi
}

# Output function
function output() {
    mkdir -p "$dir_output"
    cp -r "$dir" "$dir_output"
    if [[ "$(dirname "$dir")" != "$dir_output" ]]; then
        rm -rf "$dir"
        echo -e "${green}Content copied and original directory deleted.${reset}"
    else
        echo -e "${green}Content copied.${reset}"
    fi
}

# Main script execution
if [[ "$1" == "-h" || "$1" == "--help" ]]; then
    display_help
    exit 0
fi

validate_dirs
output
