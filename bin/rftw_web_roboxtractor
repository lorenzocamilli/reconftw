#!/bin/bash

# Default config path
CONFIG_PATH="${RECONFTW_CFG}"

# Check if the config file exists
if [[ -f "${CONFIG_PATH}" ]]; then
    source "${CONFIG_PATH}"
else
    echo "Error: reconftw.cfg not found at ${CONFIG_PATH}!"
    exit 1
fi

# Help menu
help_menu() {
	echo "$(basename "$0") [OPTIONS]"
	echo "Robots Wordlist Generation using roboxtractor"
	echo ""
	echo "Options:"
	echo "  -d, --domain DOMAIN     Set domain (required)"
	echo "  -h, --help              Display this help message and exit"
	exit 0
}

# Input validation
if [[ $# -eq 0 ]]; then
	help_menu
fi

DOMAIN=""
while [[ $1 != "" ]]; do
	case $1 in
	-d | --domain)
		shift
		DOMAIN=$1
		;;
	-h | --help)
		help_menu
		exit
		;;
	*)
		echo "Unknown option: $1"
		exit 1
		;;
	esac
	shift
done

if [[ -z ${DOMAIN} ]]; then
	echo "Error: Domain is required!"
	exit 1
fi

wordlist_gen_roboxtractor() {
	local DOMAIN=$1

	[[ ! -s ".tmp/webs_all.txt" ]] && cat webs/webs.txt webs/webs_uncommon_ports.txt 2>/dev/null | anew -q .tmp/webs_all.txt
	if [[ -s ".tmp/webs_all.txt" ]]; then
		cat .tmp/webs_all.txt | roboxtractor -m 1 -wb 2>/dev/null | anew -q webs/robots_wordlist.txt
	fi

}

wordlist_gen_roboxtractor ${DOMAIN}
